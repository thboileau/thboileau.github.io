<!DOCTYPE html>
<html lang="en-us" dir="ltr">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<link rel="apple-touch-icon" href="apple-touch-icon.png">
<link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico">
<title>Restlet framework | Prototype.js integration</title>

  
  
    
      <link rel="stylesheet" href="/css/app.min.css">
    
  



<link rel="stylesheet" type="text/css" href="/css/vendor/magnific-popup.css">

<link rel="stylesheet" href="/css/custom.css" />
<link rel="stylesheet" href="/css/app.min.css">
<link rel="stylesheet" href="/css/vendor/prism.css" />
<link rel="stylesheet" href="/css/vendor/component.css" />


      <script src="/js/main.js"></script>


</head>
<body class="static-nav documentation">

  <nav class="m-navigation m-navigation-site m-navigation-fixed" role="navigation">
  <div class="container-fluid">
    <div class="navigation-group">
      <a class="navigation-logo" href="/"><img src="/images/navbarTop.svg"></a>
      <span id="j-navigation-trigger" class="navigation-trigger"></span>
      <ul class="navigation-list navigation-list-right">
        <li class=""><a class="navigation__link" href="/features">Features</a></li>
        <li class="">
          <a class="navigation__link" href="/downloads/current">Download</a>
        </li>
        <li class="">
            <a class="navigation__link" href="/documentation/tutorials/2.5/">Documentation</a></li>
      </ul>
    </div>
  </div>
</nav>


<main id="main" role="main">
  <div class="documentation-wrapper">
<div class="sidebar-wrapper hidden-xs hidden-sm">
  <aside class="section-bg-mako text-white">
    <nav class="documentation-sidebar" aria-label="Documentation navigation" role="navigation">
      <ul id="accordion" class="nav documentation-nav">
        <li>
          <a href="#submenu-1" class="accordion-toggle toggle-switch"><img src="/images/restlet_white_32.svg">Framework</a>
          <ul id="submenu-1" class="nav panel-switch" role="menu">
            <li>
              <a href="#subsubmenu-1" class="accordion-toggle toggle-switch">User guide</a>
              <ul id="subsubmenu-1" class="nav panel-switch lowest-lewel" role="menu">
                <li><a href="/documentation/user-guide/2.3/introduction/overview" >Part 1 - Introduction</a></li>
                <li><a href="/documentation/user-guide/2.3/core/overview" >Part 2 - Core Restlet</a></li>
                <li><a href="/documentation/user-guide/2.3/editions/overview" >Part 3 - Restlet Editions</a></li>
                <li><a href="/documentation/user-guide/2.3/extensions/overview" >Part 4 - Restlet Extensions</a></li>
                <li><a href="/documentation/user-guide/2.3/appendices/glossary"class="active" >Appendices</a></li>
              </ul>
            </li>
            <li><a href="/documentation/tutorials/2.3/overview" >Tutorials</a></li>
            <li><a href="/documentation/javadocs/2.3/" >Javadocs</a></li>
            <li><a target="_blank" href="/documentation/2.3/changelog">Change Log</a></li>
          </ul>
        </li>
      </ul>
    </nav>
  </aside>

</div>

<div class="content-wrapper section-bg-white">
  <div class="row hidden-xs hidden-sm">
  <div class="col-md-12">
    <div class="h-cta h-cta--large section-bg-grey">
      <img class="large" src="/images/restlet-framework-dark.svg" alt="Restlet Framework">
      <a href="/downloads/current" class="m-button m-button-flat-green pull-right">Install Framework</a>
    </div>
  </div>
</div>

  <div class="mobile-nav hidden-md hidden-lg">
  <div class="dl-menu-container in-content">
    <div id="dl-menu" class="dl-menuwrapper">
      <button class="dl-trigger">Open Menu</button>
      <ul class="dl-menu">
        <li class="">
          <a href="#">User guide</a>
          <ul class="dl-submenu">
            <li>mobile-nav</li>


      </ul>
    </div>
  </div>
</div>


  <div class="row">
    <div class="col-md-3">
      
<nav class="inner-nav hidden-xs hidden-sm">
  <ul class="content-nav">
    
<nav class="inner-nav hidden-xs hidden-sm">
  <ul class="content-nav">
    <li>
      <a href="/documentation/user-guide/2.4/introduction/overview/">Overview</a>
    </li>
    <li>
      <a href="/documentation/user-guide/2.4/introduction/features/">Features</a>
    </li>
    <li>
      <a href="/documentation/user-guide/2.4/introduction/whats-new/">What&#39;s new</a>
        <ul>
    <li>
      <a href="/documentation/user-guide/2.4/introduction/whats-new/2.4/">In version 2.4</a>
    </li>
    <li>
      <a href="/documentation/user-guide/2.4/introduction/whats-new/2.3/">In version 2.3</a>
    </li>
    <li>
      <a href="/documentation/user-guide/2.4/introduction/whats-new/2.2/">In version 2.2</a>
    </li>
    <li>
      <a href="/documentation/user-guide/2.4/introduction/whats-new/2.1/">In version 2.1</a>
    </li>
    <li>
      <a href="/documentation/user-guide/2.4/introduction/whats-new/2.0/">2</a>
        <ul>
    <li>
      <a href="/documentation/user-guide/2.4/introduction/whats-new/2.0/api/">API improvements</a>
    </li>
    <li>
      <a href="/documentation/user-guide/2.4/introduction/whats-new/2.0/engine/">Engine</a>
    </li>
    <li>
      <a href="/documentation/user-guide/2.4/introduction/whats-new/2.0/extensions/">Extensions</a>
    </li>
    <li>
      <a href="/documentation/user-guide/2.4/introduction/whats-new/2.0/editions/">Editions</a>
    </li>
    <li>
      <a href="/documentation/user-guide/2.4/introduction/whats-new/2.0/misc/">Misc</a>
    </li>
    <li>
      <a href="/documentation/user-guide/2.4/introduction/whats-new/2.0/migration/">Migration</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
  </ul>
</nav>

  </ul>
</nav>

    </div>
    <div class="col-md-9">
      <div class="documentation-content">
        

        <h1>Prototype.js integration</h1>
        <h1 id="introduction">Introduction</h1>
<p>I will start this tutorial with a sample &ldquo;microblog&rdquo;, that&rsquo;s a text
based blog demonstrating the usage of AJAX in Restlet. Before we step
in,we should review some knowledge if you never know or forget it:</p>
<ul>
<li><a href="http://www.xfront.com/REST-Web-Services.html">What&rsquo;s RESTful</a><a href="http://www.xfront.com/REST-Web-Services.html">?</a></li>
<li><a href="../../introduction/features" title="Features">What&rsquo;s Restlet Framework?</a></li>
<li><a href="../../introduction/first-steps/overview" title="First steps">How to use Restlet Framework?</a></li>
<li><a href="http://db4o.com/about/productinformation/resources/db4o-6.3-tutorial-java.pdf">How to use db4o to simplify persistence?</a></li>
<li><a href="http://www.prototypejs.org/learn/json">How to use JSON in Prototype.js?</a></li>
</ul>
<p>This example needs to be updated for Restlet Framework 2.1. Help welcome</p>
<h1 id="demo-construction">Demo construction</h1>
<ul>
<li>Web client: call background service via JSON protocol in RESTful way
(GET/PUT/POST/DELETE).</li>
<li>Server side: uses db4o to work as store service provider, and expose
data in RESTful way.</li>
<li>Server handle process:
<a href="https://javadocs.restlet.talend.com/2.3/jse/api/org/restlet/Application.html">Application</a>
dispatches request to
<a href="https://javadocs.restlet.talend.com/2.3/jse/api/org/restlet/routing/Router.html">Router</a>,
Router finds corresponding reource,
<a href="https://javadocs.restlet.talend.com/2.3/jse/api/org/restlet/resource/Resource.html">Resource</a>
handles request and returns representation.</li>
</ul>
<h2 id="db4osimplerclass">DB4OSimpler.Class</h2>
<p>It&rsquo;s very clean from its name that it works as db4o function simpler.Its
generalOperate method handles general operation with db4o:</p>
<blockquote>
<p>**Note:**This class works as only non-concurrent model,because it doesn&rsquo;t
work as <a href="http://developer.db4o.com/resources/api/db4o-java/com/db4o/Db4o.html">client/server
model</a>.If
you have requirement,you should modify it in concurrent(client/server)
model by using <a href="http://developer.db4o.com/resources/api/db4o-java/com/db4o/Db4o.html#openServer%28java.lang.String,%20int%29">Db4o.openServer
method</a>.</p></blockquote>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a2f;font-weight:bold">package</span><span style="color:#bbb"> </span><span style="color:#00f;font-weight:bold">com.bjinfotech.util</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#a2f;font-weight:bold">import</span><span style="color:#bbb"> </span><span style="color:#00f;font-weight:bold">com.db4o.Db4o</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#a2f;font-weight:bold">import</span><span style="color:#bbb"> </span><span style="color:#00f;font-weight:bold">com.db4o.ObjectContainer</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#a2f;font-weight:bold">import</span><span style="color:#bbb"> </span><span style="color:#00f;font-weight:bold">com.db4o.query.Query</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#a2f;font-weight:bold">import</span><span style="color:#bbb"> </span><span style="color:#00f;font-weight:bold">java.util.ArrayList</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#a2f;font-weight:bold">import</span><span style="color:#bbb"> </span><span style="color:#00f;font-weight:bold">java.util.Iterator</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#a2f;font-weight:bold">import</span><span style="color:#bbb"> </span><span style="color:#00f;font-weight:bold">java.util.List</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#a2f;font-weight:bold">import</span><span style="color:#bbb"> </span><span style="color:#00f;font-weight:bold">org.apache.commons.beanutils.*</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#080;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"> * It&#39;s very clean from its name that it works as db4o function simpler.
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"> * Its generalOperate method handles general operation with db4o.
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"> * @author cleverpig
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"> *
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"> */</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#a2f;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">class</span> <span style="color:#00f">DB4OSimpler</span><span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic">//operation constants that will be used as generalOperate method&#39;s param</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#a2f;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">static</span><span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">final</span><span style="color:#bbb"> </span><span style="color:#0b0;font-weight:bold">int</span><span style="color:#bbb"> </span>OPERATION_SAVE<span style="color:#666">=</span>0;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#a2f;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">static</span><span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">final</span><span style="color:#bbb"> </span><span style="color:#0b0;font-weight:bold">int</span><span style="color:#bbb"> </span>OPERATION_LOAD<span style="color:#666">=</span>1;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#a2f;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">static</span><span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">final</span><span style="color:#bbb"> </span><span style="color:#0b0;font-weight:bold">int</span><span style="color:#bbb"> </span>OPERATION_UPDATE<span style="color:#666">=</span>2;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#a2f;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">static</span><span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">final</span><span style="color:#bbb"> </span><span style="color:#0b0;font-weight:bold">int</span><span style="color:#bbb"> </span>OPERATION_DELETE<span style="color:#666">=</span>3;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#a2f;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">static</span><span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">final</span><span style="color:#bbb"> </span><span style="color:#0b0;font-weight:bold">int</span><span style="color:#bbb"> </span>OPERATION_QUERY<span style="color:#666">=</span>4;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#a2f;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">static</span><span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">final</span><span style="color:#bbb"> </span><span style="color:#0b0;font-weight:bold">int</span><span style="color:#bbb"> </span>OPERATION_LIST<span style="color:#666">=</span>5;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#a2f;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">static</span><span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">final</span><span style="color:#bbb"> </span><span style="color:#0b0;font-weight:bold">int</span><span style="color:#bbb"> </span>OPERATION_CLEAR<span style="color:#666">=</span>6;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic">     * perform general Operation
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic">     * @param fileName
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic">     * @param op_code corresponding integer type constant
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic">     * @param example object which is needed in operation
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic">     * @param keyFieldName object&#39;s key field name
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic">     */</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#a2f;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">static</span><span style="color:#bbb"> </span>Object<span style="color:#bbb"> </span><span style="color:#00a000">generalOperate</span>(<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span>String<span style="color:#bbb"> </span>fileName,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span><span style="color:#0b0;font-weight:bold">int</span><span style="color:#bbb"> </span>op_code,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span>Object<span style="color:#bbb"> </span>example,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span>String<span style="color:#bbb"> </span>keyFieldName){<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>Object<span style="color:#bbb"> </span>ret<span style="color:#666">=</span><span style="color:#a2f;font-weight:bold">null</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span><span style="color:#080;font-style:italic">//open db4o file to get ObjectContainer</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>ObjectContainer<span style="color:#bbb"> </span>db<span style="color:#666">=</span>Db4o.<span style="color:#b44">openFile</span>(fileName);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>Iterator<span style="color:#bbb"> </span>iter<span style="color:#666">=</span><span style="color:#a2f;font-weight:bold">null</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>List<span style="color:#bbb"> </span>list<span style="color:#666">=</span><span style="color:#a2f;font-weight:bold">null</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>Query<span style="color:#bbb"> </span>query<span style="color:#666">=</span><span style="color:#a2f;font-weight:bold">null</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span><span style="color:#a2f;font-weight:bold">try</span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span><span style="color:#080;font-style:italic">//perform operation according to op_code param value</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span><span style="color:#a2f;font-weight:bold">switch</span>(op_code){<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span><span style="color:#a2f;font-weight:bold">case</span><span style="color:#bbb"> </span>OPERATION_SAVE:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span><span style="color:#080;font-style:italic">//just set!It&#39;s very simple!</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span>db.<span style="color:#b44">set</span>(example);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span>ret<span style="color:#666">=</span>example;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span><span style="color:#a2f;font-weight:bold">break</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span><span style="color:#a2f;font-weight:bold">case</span><span style="color:#bbb"> </span>OPERATION_LOAD:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span><span style="color:#080;font-style:italic">//just get!</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span>list<span style="color:#666">=</span>db.<span style="color:#b44">get</span>(example);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span><span style="color:#a2f;font-weight:bold">if</span><span style="color:#bbb"> </span>(list<span style="color:#666">!=</span><span style="color:#a2f;font-weight:bold">null</span><span style="color:#bbb"> </span><span style="color:#666">&amp;&amp;</span><span style="color:#bbb"> </span>list.<span style="color:#b44">size</span>()<span style="color:#666">&gt;</span>0){<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span>ret<span style="color:#666">=</span>list.<span style="color:#b44">get</span>(0);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span><span style="color:#a2f;font-weight:bold">break</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span><span style="color:#a2f;font-weight:bold">case</span><span style="color:#bbb"> </span>OPERATION_UPDATE:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span><span style="color:#080;font-style:italic">//at first,I find objects which will be updated with its key field value</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span>query<span style="color:#666">=</span>db.<span style="color:#b44">query</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span>query.<span style="color:#b44">constrain</span>(example.<span style="color:#b44">getClass</span>());<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span>query.<span style="color:#b44">descend</span>(keyFieldName)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span>.<span style="color:#b44">constrain</span>(BeanUtils.<span style="color:#b44">getProperty</span>(example,<span style="color:#bbb"> </span>keyFieldName));<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span>iter<span style="color:#666">=</span>query.<span style="color:#b44">execute</span>().<span style="color:#b44">listIterator</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span><span style="color:#080;font-style:italic">//and then delete all of them</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span><span style="color:#a2f;font-weight:bold">while</span>(iter.<span style="color:#b44">hasNext</span>()){<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span>db.<span style="color:#b44">delete</span>(iter.<span style="color:#b44">next</span>());<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span><span style="color:#080;font-style:italic">//set new one,now!</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span>db.<span style="color:#b44">set</span>(example);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span>ret<span style="color:#666">=</span>example;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span><span style="color:#a2f;font-weight:bold">break</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span><span style="color:#a2f;font-weight:bold">case</span><span style="color:#bbb"> </span>OPERATION_DELETE:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span><span style="color:#080;font-style:italic">//just like update process:find firstly,and then delete them</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span>query<span style="color:#666">=</span>db.<span style="color:#b44">query</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span>query.<span style="color:#b44">constrain</span>(example.<span style="color:#b44">getClass</span>());<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span>query.<span style="color:#b44">descend</span>(keyFieldName)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span>.<span style="color:#b44">constrain</span>(BeanUtils.<span style="color:#b44">getProperty</span>(example,<span style="color:#bbb"> </span>keyFieldName));<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span>iter<span style="color:#666">=</span>query.<span style="color:#b44">execute</span>().<span style="color:#b44">listIterator</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span><span style="color:#a2f;font-weight:bold">if</span><span style="color:#bbb"> </span>(iter.<span style="color:#b44">hasNext</span>()){<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span><span style="color:#a2f;font-weight:bold">while</span>(iter.<span style="color:#b44">hasNext</span>()){<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                        </span>db.<span style="color:#b44">delete</span>(iter.<span style="color:#b44">next</span>());<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span>ret<span style="color:#666">=</span><span style="color:#a2f;font-weight:bold">true</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span><span style="color:#a2f;font-weight:bold">else</span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span>ret<span style="color:#666">=</span><span style="color:#a2f;font-weight:bold">false</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span><span style="color:#a2f;font-weight:bold">break</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span><span style="color:#a2f;font-weight:bold">case</span><span style="color:#bbb"> </span>OPERATION_QUERY:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span><span style="color:#080;font-style:italic">//just like update process:find firstly,and then return them</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span>query<span style="color:#666">=</span>db.<span style="color:#b44">query</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span>query.<span style="color:#b44">constrain</span>(example.<span style="color:#b44">getClass</span>());<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span>query.<span style="color:#b44">descend</span>(keyFieldName)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span>.<span style="color:#b44">constrain</span>(BeanUtils.<span style="color:#b44">getProperty</span>(example,<span style="color:#bbb"> </span>keyFieldName));<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span>iter<span style="color:#666">=</span>query.<span style="color:#b44">execute</span>().<span style="color:#b44">listIterator</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span>list<span style="color:#666">=</span><span style="color:#a2f;font-weight:bold">new</span><span style="color:#bbb"> </span>ArrayList();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span><span style="color:#a2f;font-weight:bold">while</span>(iter.<span style="color:#b44">hasNext</span>()){<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                        </span>list.<span style="color:#b44">add</span>(iter.<span style="color:#b44">next</span>());<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span><span style="color:#a2f;font-weight:bold">if</span><span style="color:#bbb"> </span>(list.<span style="color:#b44">size</span>()<span style="color:#666">&gt;</span>0)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span>ret<span style="color:#666">=</span>list;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span><span style="color:#a2f;font-weight:bold">break</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span><span style="color:#a2f;font-weight:bold">case</span><span style="color:#bbb"> </span>OPERATION_LIST:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span><span style="color:#080;font-style:italic">//return list of object which class is example.class.</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span>list<span style="color:#666">=</span><span style="color:#a2f;font-weight:bold">new</span><span style="color:#bbb"> </span>ArrayList();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span>iter<span style="color:#666">=</span>db.<span style="color:#b44">query</span>(example.<span style="color:#b44">getClass</span>()).<span style="color:#b44">listIterator</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span><span style="color:#a2f;font-weight:bold">while</span>(iter.<span style="color:#b44">hasNext</span>()){<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span>list.<span style="color:#b44">add</span>(iter.<span style="color:#b44">next</span>());<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span><span style="color:#a2f;font-weight:bold">if</span><span style="color:#bbb"> </span>(list.<span style="color:#b44">size</span>()<span style="color:#666">&gt;</span>0)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span>ret<span style="color:#666">=</span>list;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span><span style="color:#a2f;font-weight:bold">break</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span><span style="color:#a2f;font-weight:bold">case</span><span style="color:#bbb"> </span>OPERATION_CLEAR:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span><span style="color:#080;font-style:italic">//delete anything which class is example.class.</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span>iter<span style="color:#666">=</span>db.<span style="color:#b44">query</span>(example.<span style="color:#b44">getClass</span>()).<span style="color:#b44">listIterator</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span><span style="color:#0b0;font-weight:bold">int</span><span style="color:#bbb"> </span>deleteCount<span style="color:#666">=</span>0;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span><span style="color:#a2f;font-weight:bold">while</span>(iter.<span style="color:#b44">hasNext</span>()){<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span>db.<span style="color:#b44">delete</span>(iter.<span style="color:#b44">next</span>());<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span>deleteCount<span style="color:#666">++</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span>};<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span>ret<span style="color:#666">=</span><span style="color:#a2f;font-weight:bold">true</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span><span style="color:#a2f;font-weight:bold">break</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span><span style="color:#080;font-style:italic">//commit,finally</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span>db.<span style="color:#b44">commit</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span><span style="color:#a2f;font-weight:bold">catch</span>(Exception<span style="color:#bbb"> </span>ex){<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span>db.<span style="color:#b44">rollback</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span>ex.<span style="color:#b44">printStackTrace</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span><span style="color:#a2f;font-weight:bold">finally</span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span>db.<span style="color:#b44">close</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span><span style="color:#a2f;font-weight:bold">return</span><span style="color:#bbb"> </span>ret;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}</span></span></code></pre></div>
<h2 id="microblogapplicationclass">MicroblogApplication.Class</h2>
<p>It&rsquo;s a restful Micoblog Server which serves static files and
resource(MicroblogResource) and exposes some services(static html and
Microblog):</p>
<blockquote>
<p><strong>Note:</strong> I used TunnelService replacing custom finder,&lsquo;cause I
think TunnelService is easy for using.But I&rsquo;d discuss how to using
custom finder to implement same function.</p></blockquote>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a2f;font-weight:bold">package</span><span style="color:#bbb"> </span><span style="color:#00f;font-weight:bold">com.bjinfotech.restlet.practice.demo.microblog</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#a2f;font-weight:bold">import</span><span style="color:#bbb"> </span><span style="color:#00f;font-weight:bold">org.restlet.Application</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#a2f;font-weight:bold">import</span><span style="color:#bbb"> </span><span style="color:#00f;font-weight:bold">org.restlet.Component</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#a2f;font-weight:bold">import</span><span style="color:#bbb"> </span><span style="color:#00f;font-weight:bold">org.restlet.Directory</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#a2f;font-weight:bold">import</span><span style="color:#bbb"> </span><span style="color:#00f;font-weight:bold">org.restlet.Restlet</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#a2f;font-weight:bold">import</span><span style="color:#bbb"> </span><span style="color:#00f;font-weight:bold">org.restlet.Router</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#a2f;font-weight:bold">import</span><span style="color:#bbb"> </span><span style="color:#00f;font-weight:bold">org.restlet.data.Protocol</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#080;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"> * restful server
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"> * it serves static files and resource
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"> * @author cleverpig
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"> *
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"> */</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#a2f;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">class</span> <span style="color:#00f">MicroblogApplication</span><span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#a2f;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">static</span><span style="color:#bbb"> </span><span style="color:#0b0;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#00a000">main</span>(String<span style="color:#666">[]</span><span style="color:#bbb"> </span>argv)<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">throws</span><span style="color:#bbb"> </span>Exception{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>Component<span style="color:#bbb"> </span>component<span style="color:#666">=</span><span style="color:#a2f;font-weight:bold">new</span><span style="color:#bbb"> </span>Component();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span><span style="color:#080;font-style:italic">//add http protocol</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>component.<span style="color:#b44">getServers</span>().<span style="color:#b44">add</span>(Protocol.<span style="color:#b44">HTTP</span>,8182);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span><span style="color:#080;font-style:italic">//add file protocol for accessing static web files in some directories</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>component.<span style="color:#b44">getClients</span>().<span style="color:#b44">add</span>(Protocol.<span style="color:#b44">FILE</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>Application<span style="color:#bbb"> </span>application<span style="color:#666">=</span><span style="color:#a2f;font-weight:bold">new</span><span style="color:#bbb"> </span>Application(component.<span style="color:#b44">getContext</span>()){<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span><span style="color:#a2f">@Override</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span><span style="color:#a2f;font-weight:bold">public</span><span style="color:#bbb"> </span>Restlet<span style="color:#bbb"> </span><span style="color:#00a000">createRoot</span>(){<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span><span style="color:#080;font-style:italic">//directory where static web files live</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span><span style="color:#a2f;font-weight:bold">final</span><span style="color:#bbb"> </span>String<span style="color:#bbb"> </span>DIR_ROOT_URI<span style="color:#666">=</span><span style="color:#b44">&#34;file:///E:/eclipse3.1RC3/workspace/RestletPractice/static_files/&#34;</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span><span style="color:#080;font-style:italic">//create router</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span>Router<span style="color:#bbb"> </span>router<span style="color:#666">=</span><span style="color:#a2f;font-weight:bold">new</span><span style="color:#bbb"> </span>Router(getContext());<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span><span style="color:#080;font-style:italic">//attach static web files to &#34;www&#34; folder</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span>Directory<span style="color:#bbb"> </span>dir<span style="color:#666">=</span><span style="color:#a2f;font-weight:bold">new</span><span style="color:#bbb"> </span>Directory(getContext(),DIR_ROOT_URI);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span>dir.<span style="color:#b44">setListingAllowed</span>(<span style="color:#a2f;font-weight:bold">true</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span>dir.<span style="color:#b44">setDeeplyAccessible</span>(<span style="color:#a2f;font-weight:bold">true</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span>dir.<span style="color:#b44">setNegotiateContent</span>(<span style="color:#a2f;font-weight:bold">true</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span>router.<span style="color:#b44">attach</span>(<span style="color:#b44">&#34;/www/&#34;</span>,dir);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span><span style="color:#080;font-style:italic">//attach resource class:MicroblogResource to &#34;/restful/blog&#34; as web service URI</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span>router.<span style="color:#b44">attach</span>(<span style="color:#b44">&#34;/restful/blog&#34;</span>,MicroblogResource.<span style="color:#b44">class</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                </span><span style="color:#a2f;font-weight:bold">return</span><span style="color:#bbb"> </span>router;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>};<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span><span style="color:#080;font-style:italic">//use TunnelService to simplify request&#39;s dispatching  </span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>application.<span style="color:#b44">getTunnelService</span>().<span style="color:#b44">setEnabled</span>(<span style="color:#a2f;font-weight:bold">true</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>application.<span style="color:#b44">getTunnelService</span>().<span style="color:#b44">setMethodTunnel</span>(<span style="color:#a2f;font-weight:bold">true</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>application.<span style="color:#b44">getTunnelService</span>().<span style="color:#b44">setMethodParameter</span>(<span style="color:#b44">&#34;method&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span><span style="color:#080;font-style:italic">//attach application</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>component.<span style="color:#b44">getDefaultHost</span>().<span style="color:#b44">attach</span>(application);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>component.<span style="color:#b44">start</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}</span></span></code></pre></div>
<h2 id="microblogappinterfacejs">microblogAppInterface.js</h2>
<p>This is a JavaScript file used in microblog.html file,it call functions
which was exposed in server side:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span>  <span style="color:#a2f;font-weight:bold">var</span> SAVE_MODEL<span style="color:#666">=</span><span style="color:#666">1</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#a2f;font-weight:bold">var</span> UPDATE_MODEL<span style="color:#666">=</span><span style="color:#666">2</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a2f;font-weight:bold">function</span> switchEditorModel(model){
</span></span><span style="display:flex;"><span>      <span style="color:#a2f;font-weight:bold">switch</span>(model){
</span></span><span style="display:flex;"><span>          <span style="color:#a2f;font-weight:bold">case</span> SAVE_MODEL<span style="color:#666">:</span>
</span></span><span style="display:flex;"><span>              Element.show(<span style="color:#b44">&#39;save_button&#39;</span>);
</span></span><span style="display:flex;"><span>              Element.hide(<span style="color:#b44">&#39;update_button&#39;</span>);
</span></span><span style="display:flex;"><span>              Element.hide(<span style="color:#b44">&#39;remove_button&#39;</span>);
</span></span><span style="display:flex;"><span>              Element.hide(<span style="color:#b44">&#39;new_button&#39;</span>);
</span></span><span style="display:flex;"><span>              <span style="color:#a2f;font-weight:bold">break</span>;
</span></span><span style="display:flex;"><span>          <span style="color:#a2f;font-weight:bold">case</span> UPDATE_MODEL<span style="color:#666">:</span>
</span></span><span style="display:flex;"><span>              Element.hide(<span style="color:#b44">&#39;save_button&#39;</span>);
</span></span><span style="display:flex;"><span>              Element.show(<span style="color:#b44">&#39;update_button&#39;</span>);
</span></span><span style="display:flex;"><span>              Element.show(<span style="color:#b44">&#39;remove_button&#39;</span>);
</span></span><span style="display:flex;"><span>              Element.show(<span style="color:#b44">&#39;new_button&#39;</span>);
</span></span><span style="display:flex;"><span>              <span style="color:#a2f;font-weight:bold">break</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  ...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  Event.observe(
</span></span><span style="display:flex;"><span>      <span style="color:#b44">&#39;save_button&#39;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#b44">&#39;click&#39;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a2f;font-weight:bold">function</span>(){
</span></span><span style="display:flex;"><span>          <span style="color:#a2f;font-weight:bold">var</span> formObj<span style="color:#666">=</span>Form.serialize(<span style="color:#b44">&#39;edit_form&#39;</span>,<span style="color:#a2f;font-weight:bold">true</span>);
</span></span><span style="display:flex;"><span>          <span style="color:#a2f;font-weight:bold">var</span> xmlHttp <span style="color:#666">=</span> <span style="color:#a2f;font-weight:bold">new</span> Ajax.Request(
</span></span><span style="display:flex;"><span>              <span style="color:#b44">&#34;/restful/blog?method=PUT&#34;</span>,
</span></span><span style="display:flex;"><span>              {
</span></span><span style="display:flex;"><span>                  method<span style="color:#666">:</span> <span style="color:#b44">&#39;post&#39;</span>,
</span></span><span style="display:flex;"><span>                  parameters<span style="color:#666">:</span> <span style="color:#b44">&#39;json=&#39;</span><span style="color:#666">+</span><span style="color:#a2f">encodeURIComponent</span>(<span style="color:#a2f">Object</span>.toJSON(formObj)),
</span></span><span style="display:flex;"><span>                  onComplete<span style="color:#666">:</span> <span style="color:#a2f;font-weight:bold">function</span>(transport){
</span></span><span style="display:flex;"><span>                      <span style="color:#a2f;font-weight:bold">var</span> retObj<span style="color:#666">=</span>transport.responseText.evalJSON();
</span></span><span style="display:flex;"><span>                      <span style="color:#a2f;font-weight:bold">if</span> (retObj.subject){
</span></span><span style="display:flex;"><span>                          alert(<span style="color:#b44">&#39;ok,&#34;&#39;</span><span style="color:#666">+</span>retObj.subject<span style="color:#666">+</span><span style="color:#b44">&#39;&#34; was saved!&#39;</span>);
</span></span><span style="display:flex;"><span>                          refreshBloglist();
</span></span><span style="display:flex;"><span>                          switchEditorModel(UPDATE_MODEL);
</span></span><span style="display:flex;"><span>                      }
</span></span><span style="display:flex;"><span>                  }
</span></span><span style="display:flex;"><span>              }
</span></span><span style="display:flex;"><span>          );
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="color:#a2f;font-weight:bold">false</span>
</span></span><span style="display:flex;"><span>  );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  ...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a2f;font-weight:bold">function</span> refreshBloglist(){
</span></span><span style="display:flex;"><span>      <span style="color:#a2f;font-weight:bold">var</span> xmlHttp <span style="color:#666">=</span> <span style="color:#a2f;font-weight:bold">new</span> Ajax.Request(
</span></span><span style="display:flex;"><span>          <span style="color:#b44">&#34;/restful/blog&#34;</span>,
</span></span><span style="display:flex;"><span>          {
</span></span><span style="display:flex;"><span>              method<span style="color:#666">:</span> <span style="color:#b44">&#39;get&#39;</span>,
</span></span><span style="display:flex;"><span>              parameters<span style="color:#666">:</span> <span style="color:#b44">&#39;&#39;</span>,
</span></span><span style="display:flex;"><span>              onComplete<span style="color:#666">:</span> <span style="color:#a2f;font-weight:bold">function</span>(transport){
</span></span><span style="display:flex;"><span>                  <span style="color:#a2f;font-weight:bold">var</span> retObjs<span style="color:#666">=</span>transport.responseText.evalJSON();
</span></span><span style="display:flex;"><span>                  <span style="color:#a2f;font-weight:bold">if</span> (retObjs.length <span style="color:#666">&amp;&amp;</span> retObjs.length<span style="color:#666">&gt;</span><span style="color:#666">0</span>){
</span></span><span style="display:flex;"><span>                      <span style="color:#a2f;font-weight:bold">var</span> listRepr<span style="color:#666">=</span><span style="color:#b44">&#39;&lt;ul&gt;\n&#39;</span>;
</span></span><span style="display:flex;"><span>                      retObjs.each(<span style="color:#a2f;font-weight:bold">function</span>(obj,index){
</span></span><span style="display:flex;"><span>                          <span style="color:#a2f;font-weight:bold">if</span> (index<span style="color:#666">&lt;</span>retobjs.length<span style="color:#666">-</span><span style="color:#666">1</span> ) listrepr<span style="color:#666">+=</span><span style="color:#b44">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#b44">  &lt;li&gt;&#34;</span><span style="color:#666">&gt;&lt;</span>a href<span style="color:#666">=</span><span style="color:#b44">&#34;javascript:load(\&#39;&#39;+obj.subject+&#39;\&#39;);&#34;</span><span style="color:#666">&gt;</span><span style="color:#b44">&#39;+obj.subject+&#39;</span><span style="color:#666">&lt;</span><span style="">/a&gt;\n&#39;;</span>
</span></span><span style="display:flex;"><span>                      });
</span></span><span style="display:flex;"><span>                      listRepr<span style="color:#666">+=</span><span style="color:#b44">&#34;&lt;\ul&gt;\n&#34;</span>;
</span></span><span style="display:flex;"><span>                      $(<span style="color:#b44">&#39;blogList&#39;</span>).innerHTML<span style="color:#666">=</span>listRepr;
</span></span><span style="display:flex;"><span>                  }
</span></span><span style="display:flex;"><span>                  <span style="color:#a2f;font-weight:bold">else</span>{
</span></span><span style="display:flex;"><span>                      $(<span style="color:#b44">&#39;blogList&#39;</span>).innerHTML<span style="color:#666">=</span><span style="color:#b44">&#39;Here is empty&#39;</span>;
</span></span><span style="display:flex;"><span>                  }
</span></span><span style="display:flex;"><span>              }
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>      );
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#a2f;font-weight:bold">function</span> load(subject){
</span></span><span style="display:flex;"><span>      <span style="color:#a2f;font-weight:bold">var</span> xmlHttp <span style="color:#666">=</span> <span style="color:#a2f;font-weight:bold">new</span> Ajax.Request(
</span></span><span style="display:flex;"><span>              <span style="color:#b44">&#34;/restful/blog&#34;</span>,
</span></span><span style="display:flex;"><span>              {
</span></span><span style="display:flex;"><span>                  method<span style="color:#666">:</span> <span style="color:#b44">&#39;get&#39;</span>,
</span></span><span style="display:flex;"><span>                  parameters<span style="color:#666">:</span> <span style="color:#b44">&#39;subject=&#39;</span><span style="color:#666">+</span><span style="color:#a2f">encodeURIComponent</span>(subject),
</span></span><span style="display:flex;"><span>                  onComplete<span style="color:#666">:</span> <span style="color:#a2f;font-weight:bold">function</span>(transport){
</span></span><span style="display:flex;"><span>                      <span style="color:#a2f;font-weight:bold">var</span> retObj<span style="color:#666">=</span>transport.responseText.evalJSON();
</span></span><span style="display:flex;"><span>                      <span style="color:#a2f;font-weight:bold">if</span> (retObj.subject){
</span></span><span style="display:flex;"><span>                          $(<span style="color:#b44">&#39;subject&#39;</span>).value<span style="color:#666">=</span>retObj.subject;
</span></span><span style="display:flex;"><span>                          $(<span style="color:#b44">&#39;content&#39;</span>).value<span style="color:#666">=</span>retObj.content;
</span></span><span style="display:flex;"><span>                          $(<span style="color:#b44">&#39;tags&#39;</span>).value<span style="color:#666">=</span>retObj.tags;
</span></span><span style="display:flex;"><span>                          alert(<span style="color:#b44">&#39;ok,&#34;&#39;</span><span style="color:#666">+</span>retObj.subject<span style="color:#666">+</span><span style="color:#b44">&#39;&#34; was loaded!&#39;</span>);
</span></span><span style="display:flex;"><span>                          switchEditorModel(UPDATE_MODEL);
</span></span><span style="display:flex;"><span>                      }
</span></span><span style="display:flex;"><span>                  }
</span></span><span style="display:flex;"><span>              }
</span></span><span style="display:flex;"><span>          );
</span></span><span style="display:flex;"><span>  }</span></span></code></pre></div>
<h2 id="microblogresourceclass">MicroblogResource.Class</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">package</span><span style="color:#bbb"> </span><span style="color:#00f;font-weight:bold">com.bjinfotech.restlet.practice.demo.microblog</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">import</span><span style="color:#bbb"> </span><span style="color:#00f;font-weight:bold">java.util.List</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">import</span><span style="color:#bbb"> </span><span style="color:#00f;font-weight:bold">java.util.logging.Logger</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">import</span><span style="color:#bbb"> </span><span style="color:#00f;font-weight:bold">org.restlet.Context</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">import</span><span style="color:#bbb"> </span><span style="color:#00f;font-weight:bold">org.restlet.data.CharacterSet</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">import</span><span style="color:#bbb"> </span><span style="color:#00f;font-weight:bold">org.restlet.data.Form</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">import</span><span style="color:#bbb"> </span><span style="color:#00f;font-weight:bold">org.restlet.data.Language</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">import</span><span style="color:#bbb"> </span><span style="color:#00f;font-weight:bold">org.restlet.data.MediaType</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">import</span><span style="color:#bbb"> </span><span style="color:#00f;font-weight:bold">org.restlet.data.Request</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">import</span><span style="color:#bbb"> </span><span style="color:#00f;font-weight:bold">org.restlet.data.Response</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">import</span><span style="color:#bbb"> </span><span style="color:#00f;font-weight:bold">org.restlet.resource.Representation</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">import</span><span style="color:#bbb"> </span><span style="color:#00f;font-weight:bold">org.restlet.resource.Resource</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">import</span><span style="color:#bbb"> </span><span style="color:#00f;font-weight:bold">org.restlet.resource.ResourceException</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">import</span><span style="color:#bbb"> </span><span style="color:#00f;font-weight:bold">org.restlet.resource.StringRepresentation</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">import</span><span style="color:#bbb"> </span><span style="color:#00f;font-weight:bold">org.restlet.resource.Variant</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">import</span><span style="color:#bbb"> </span><span style="color:#00f;font-weight:bold">org.restlet.data.Status</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">import</span><span style="color:#bbb"> </span><span style="color:#00f;font-weight:bold">com.bjinfotech.util.JSONSimpler</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">import</span><span style="color:#bbb"> </span><span style="color:#00f;font-weight:bold">com.bjinfotech.util.Utils</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">class</span> <span style="color:#00f">MicroblogResource</span><span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">extends</span><span style="color:#bbb"> </span>Resource<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">     </span>Logger<span style="color:#bbb"> </span>log<span style="color:#666">=</span>Logger.<span style="color:#b44">getLogger</span>(MicroblogResource.<span style="color:#b44">class</span>.<span style="color:#b44">getSimpleName</span>());<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">     </span><span style="color:#080;font-style:italic">//MicroblogPersistenceManager</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">     </span>MicroblogPersistenceManager<span style="color:#bbb"> </span>micoblogPM<span style="color:#666">=</span><span style="color:#a2f;font-weight:bold">new</span><span style="color:#bbb"> </span>MicroblogPersistenceManager();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">     </span><span style="color:#080;font-style:italic">//StringRepresentation constant</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">     </span><span style="color:#a2f;font-weight:bold">final</span><span style="color:#bbb"> </span>StringRepresentation<span style="color:#bbb"> </span>NO_FOUND_REPR<span style="color:#666">=</span><span style="color:#a2f;font-weight:bold">new</span><span style="color:#bbb"> </span>StringRepresentation(<span style="color:#b44">&#34;No found!&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">     </span><span style="color:#a2f;font-weight:bold">final</span><span style="color:#bbb"> </span>StringRepresentation<span style="color:#bbb"> </span>ERR_REPR<span style="color:#666">=</span><span style="color:#a2f;font-weight:bold">new</span><span style="color:#bbb"> </span>StringRepresentation(<span style="color:#b44">&#34;something wrong!&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">     </span><span style="color:#080;font-style:italic">//json param name in request</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">     </span><span style="color:#a2f;font-weight:bold">final</span><span style="color:#bbb"> </span>String<span style="color:#bbb"> </span>JSON_PARAM<span style="color:#666">=</span><span style="color:#b44">&#34;json&#34;</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">     </span><span style="color:#a2f;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#00a000">MicroblogResource</span>(<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">             </span>Context<span style="color:#bbb"> </span>context,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">             </span>Request<span style="color:#bbb"> </span>request,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">             </span>Response<span style="color:#bbb"> </span>response)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">         </span><span style="color:#a2f;font-weight:bold">super</span>(context,<span style="color:#bbb"> </span>request,<span style="color:#bbb"> </span>response);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">         </span><span style="color:#a2f;font-weight:bold">this</span>.<span style="color:#b44">getVariants</span>().<span style="color:#b44">add</span>(<span style="color:#a2f;font-weight:bold">new</span><span style="color:#bbb"> </span>Variant(MediaType.<span style="color:#b44">TEXT_PLAIN</span>));<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">         </span><span style="color:#080;font-style:italic">//it&#39;s important,please don&#39;t forget it.</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">         </span><span style="color:#a2f;font-weight:bold">this</span>.<span style="color:#b44">setAvailable</span>(<span style="color:#a2f;font-weight:bold">true</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">         </span><span style="color:#a2f;font-weight:bold">this</span>.<span style="color:#b44">setModifiable</span>(<span style="color:#a2f;font-weight:bold">true</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">         </span><span style="color:#a2f;font-weight:bold">this</span>.<span style="color:#b44">setNegotiateContent</span>(<span style="color:#a2f;font-weight:bold">true</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">     </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">     </span><span style="color:#a2f">@Override</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">     </span><span style="color:#080;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic">      * representing after calling default get handle
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic">      * @param variant
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic">      */</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">     </span><span style="color:#a2f;font-weight:bold">public</span><span style="color:#bbb"> </span>Representation<span style="color:#bbb"> </span><span style="color:#00a000">represent</span>(Variant<span style="color:#bbb"> </span>variant)<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">throws</span><span style="color:#bbb"> </span>ResourceException{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">         </span>log.<span style="color:#b44">info</span>(<span style="color:#b44">&#34;representing after calling default get handle...&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">         </span>Representation<span style="color:#bbb"> </span>result<span style="color:#bbb"> </span><span style="color:#666">=</span><span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">null</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">         </span><span style="color:#a2f;font-weight:bold">if</span><span style="color:#bbb"> </span>(variant.<span style="color:#b44">getMediaType</span>().<span style="color:#b44">equals</span>(MediaType.<span style="color:#b44">TEXT_PLAIN</span>))<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">             </span><span style="color:#080;font-style:italic">//find &#34;subject&#34; param in request,&#34;subject&#34; param is tranformed from web client.it means load one blog with special subject</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">             </span>String<span style="color:#bbb"> </span>subject<span style="color:#666">=</span>getRequest().<span style="color:#b44">getResourceRef</span>().<span style="color:#b44">getQueryAsForm</span>().<span style="color:#b44">getFirstValue</span>(<span style="color:#b44">&#34;subject&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">             </span>log.<span style="color:#b44">info</span>(<span style="color:#b44">&#34;subject:&#34;</span><span style="color:#666">+</span>subject);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">             </span><span style="color:#080;font-style:italic">//handle query</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">             </span><span style="color:#a2f;font-weight:bold">if</span><span style="color:#bbb"> </span>(subject<span style="color:#666">!=</span><span style="color:#a2f;font-weight:bold">null</span><span style="color:#bbb"> </span><span style="color:#666">&amp;&amp;</span><span style="color:#bbb"> </span>subject.<span style="color:#b44">length</span>()<span style="color:#666">&gt;</span>0){<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                 </span><span style="color:#080;font-style:italic">//find blog with special subject</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                 </span>Microblog<span style="color:#bbb"> </span>example<span style="color:#666">=</span><span style="color:#a2f;font-weight:bold">new</span><span style="color:#bbb"> </span>Microblog();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                 </span>example.<span style="color:#b44">setSubject</span>(subject);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                 </span>List<span style="color:#bbb"> </span>queryRet<span style="color:#666">=</span>micoblogPM.<span style="color:#b44">query</span>(example);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                 </span><span style="color:#080;font-style:italic">//return result in JSON format StringRepresentation</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                 </span><span style="color:#a2f;font-weight:bold">if</span><span style="color:#bbb"> </span>(queryRet<span style="color:#666">!=</span><span style="color:#a2f;font-weight:bold">null</span><span style="color:#bbb"> </span><span style="color:#666">&amp;&amp;</span><span style="color:#bbb"> </span>queryRet.<span style="color:#b44">size</span>()<span style="color:#666">&gt;</span>0){<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                     </span>result<span style="color:#666">=</span><span style="color:#a2f;font-weight:bold">new</span><span style="color:#bbb"> </span>StringRepresentation(<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                             </span>JSONSimpler.<span style="color:#b44">serializeFromBean</span>(queryRet.<span style="color:#b44">get</span>(0)),<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                             </span>MediaType.<span style="color:#b44">APPLICATION_JSON</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                             </span>Language.<span style="color:#b44">ALL</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                             </span>CharacterSet.<span style="color:#b44">UTF_8</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                         </span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                 </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                 </span><span style="color:#a2f;font-weight:bold">else</span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                     </span>result<span style="color:#666">=</span>NO_FOUND_REPR;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                 </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">             </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">             </span><span style="color:#a2f;font-weight:bold">else</span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                 </span><span style="color:#080;font-style:italic">//return blog list in JSON format StringRepresentation</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                 </span>result<span style="color:#666">=</span><span style="color:#a2f;font-weight:bold">new</span><span style="color:#bbb"> </span>StringRepresentation(<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                         </span>JSONSimpler.<span style="color:#b44">serializeFromBeanList</span>(micoblogPM.<span style="color:#b44">list</span>()),<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                         </span>MediaType.<span style="color:#b44">APPLICATION_JSON</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                         </span>Language.<span style="color:#b44">ALL</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                         </span>CharacterSet.<span style="color:#b44">UTF_8</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                     </span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">             </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">         </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">         </span><span style="color:#a2f;font-weight:bold">return</span><span style="color:#bbb"> </span>result;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">     </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#080;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic">      * call MicroblogPersistenceManager&#39;s method excluding query and list,just save/update/delete.
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic">      * @param method method name
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic">      * @param jsonParamVal json param value coming from request
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic">      * @return
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic">      */</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">     </span><span style="color:#a2f;font-weight:bold">protected</span><span style="color:#bbb"> </span>StringRepresentation<span style="color:#bbb"> </span><span style="color:#00a000">callMethod</span>(String<span style="color:#bbb"> </span>method,String<span style="color:#bbb"> </span>jsonParamVal){<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">         </span><span style="color:#080;font-style:italic">//transform json format string to Microblog object</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">         </span>Microblog<span style="color:#bbb"> </span>microblog<span style="color:#666">=</span>(Microblog)JSONSimpler.<span style="color:#b44">deserializeToBean</span>(jsonParamVal,Microblog.<span style="color:#b44">class</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">         </span><span style="color:#a2f;font-weight:bold">if</span><span style="color:#bbb"> </span>(microblog<span style="color:#666">!=</span><span style="color:#a2f;font-weight:bold">null</span>){<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">             </span><span style="color:#080;font-style:italic">//call method and gain json format string as responseText</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">             </span>String<span style="color:#bbb"> </span>responseText<span style="color:#666">=</span>Utils.<span style="color:#b44">callMethodAndGainResponseJSONStr</span>(<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                     </span>micoblogPM,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                     </span>method,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                     </span>jsonParamVal,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                     </span>Microblog.<span style="color:#b44">class</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">             </span>log.<span style="color:#b44">info</span>(<span style="color:#b44">&#34;response:&#34;</span><span style="color:#666">+</span>responseText);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">             </span><span style="color:#080;font-style:italic">//return json StringRepresentation</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">             </span><span style="color:#a2f;font-weight:bold">return</span><span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">new</span><span style="color:#bbb"> </span>StringRepresentation(<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                     </span>responseText,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                     </span>MediaType.<span style="color:#b44">APPLICATION_JSON</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                     </span>Language.<span style="color:#b44">ALL</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                     </span>CharacterSet.<span style="color:#b44">UTF_8</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">             </span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">         </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">         </span><span style="color:#a2f;font-weight:bold">else</span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">             </span><span style="color:#a2f;font-weight:bold">return</span><span style="color:#bbb"> </span>ERR_REPR;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">         </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">     </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">     </span><span style="color:#a2f">@Override</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">     </span><span style="color:#080;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic">      * handling post in high level
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic">      * @param entity
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic">      */</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">     </span><span style="color:#a2f;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#0b0;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#00a000">acceptRepresentation</span>(Representation<span style="color:#bbb"> </span>entity)<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">throws</span><span style="color:#bbb"> </span>ResourceException{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">         </span>log.<span style="color:#b44">info</span>(<span style="color:#b44">&#34;handling post in high level...&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">         </span><span style="color:#a2f;font-weight:bold">super</span>.<span style="color:#b44">acceptRepresentation</span>(entity);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">         </span>getResponse().<span style="color:#b44">setStatus</span>(Status.<span style="color:#b44">SUCCESS_OK</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">         </span>Form<span style="color:#bbb"> </span>f<span style="color:#bbb"> </span><span style="color:#666">=</span><span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">new</span><span style="color:#bbb"> </span>Form(entity);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">         </span>String<span style="color:#bbb"> </span>jsonParamVal<span style="color:#666">=</span>f.<span style="color:#b44">getValues</span>(JSON_PARAM);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">         </span>log.<span style="color:#b44">info</span>(<span style="color:#b44">&#34;json param:&#34;</span><span style="color:#666">+</span>jsonParamVal);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">         </span><span style="color:#080;font-style:italic">//call update and set response</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">         </span>getResponse().<span style="color:#b44">setEntity</span>(callMethod(<span style="color:#b44">&#34;update&#34;</span>,jsonParamVal));<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">     </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">     </span><span style="color:#a2f">@Override</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">     </span><span style="color:#080;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic">      * handling put in high level
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic">      * @param entity
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic">      */</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">     </span><span style="color:#a2f;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#0b0;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#00a000">storeRepresentation</span>(Representation<span style="color:#bbb"> </span>entity)<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">throws</span><span style="color:#bbb"> </span>ResourceException{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">         </span>log.<span style="color:#b44">info</span>(<span style="color:#b44">&#34;handling put in high level...&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">         </span><span style="color:#a2f;font-weight:bold">super</span>.<span style="color:#b44">storeRepresentation</span>(entity);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">         </span>getResponse().<span style="color:#b44">setStatus</span>(Status.<span style="color:#b44">SUCCESS_CREATED</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">         </span>Form<span style="color:#bbb"> </span>f<span style="color:#bbb"> </span><span style="color:#666">=</span><span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">new</span><span style="color:#bbb"> </span>Form(entity);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">         </span>String<span style="color:#bbb"> </span>jsonParamVal<span style="color:#666">=</span>f.<span style="color:#b44">getValues</span>(JSON_PARAM);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">         </span>log.<span style="color:#b44">info</span>(<span style="color:#b44">&#34;json param:&#34;</span><span style="color:#666">+</span>jsonParamVal);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">         </span><span style="color:#080;font-style:italic">//call save and set response</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">         </span>getResponse().<span style="color:#b44">setEntity</span>(callMethod(<span style="color:#b44">&#34;save&#34;</span>,jsonParamVal));<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">     </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">     </span><span style="color:#a2f">@Override</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">     </span><span style="color:#080;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic">      * handling delete in high level
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic">      * @param entity
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic">      */</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">     </span><span style="color:#a2f;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#0b0;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#00a000">removeRepresentations</span>()<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">throws</span><span style="color:#bbb"> </span>ResourceException{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">         </span>log.<span style="color:#b44">info</span>(<span style="color:#b44">&#34;handling delete in high level...&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">         </span><span style="color:#a2f;font-weight:bold">super</span>.<span style="color:#b44">removeRepresentations</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">         </span>getResponse().<span style="color:#b44">setStatus</span>(Status.<span style="color:#b44">SUCCESS_OK</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">         </span>Form<span style="color:#bbb"> </span>f<span style="color:#bbb"> </span><span style="color:#666">=</span><span style="color:#bbb"> </span>getRequest().<span style="color:#b44">getEntityAsForm</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">         </span>String<span style="color:#bbb"> </span>jsonParamVal<span style="color:#666">=</span>f.<span style="color:#b44">getValues</span>(JSON_PARAM);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">         </span>log.<span style="color:#b44">info</span>(<span style="color:#b44">&#34;json param:&#34;</span><span style="color:#666">+</span>jsonParamVal);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">         </span><span style="color:#080;font-style:italic">//call delete and set response</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">         </span>getResponse().<span style="color:#b44">setEntity</span>(callMethod(<span style="color:#b44">&#34;delete&#34;</span>,jsonParamVal));<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">     </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> </span>}</span></span></code></pre></div>
<h2 id="microblogclass">Microblog.Class</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a2f;font-weight:bold">package</span><span style="color:#bbb"> </span><span style="color:#00f;font-weight:bold">com.bjinfotech.restlet.practice.demo.microblog</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#a2f;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">class</span> <span style="color:#00f">Microblog</span><span style="color:#bbb"> </span>{<span style="">\</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">   </span><span style="color:#a2f;font-weight:bold">private</span><span style="color:#bbb"> </span>String<span style="color:#bbb"> </span>subject;<span style="">\</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">   </span><span style="color:#a2f;font-weight:bold">private</span><span style="color:#bbb"> </span>String<span style="color:#bbb"> </span>content;<span style="">\</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">   </span><span style="color:#a2f;font-weight:bold">private</span><span style="color:#bbb"> </span>String<span style="color:#bbb"> </span>tags;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">   </span><span style="color:#a2f;font-weight:bold">public</span><span style="color:#bbb"> </span>String<span style="color:#bbb"> </span><span style="color:#00a000">getSubject</span>()<span style="color:#bbb"> </span>{<span style="">\</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">       </span><span style="color:#a2f;font-weight:bold">return</span><span style="color:#bbb"> </span>subject;<span style="">\</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">   </span>}<span style="">\</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">   </span>...<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}</span></span></code></pre></div>
<h1 id="running-application">Running Application</h1>
<p>Running MicroblogApplication,and visit
http://localhost:8182/www/microblog.html.</p>
<hr>
<h2 id="click-to-enlarge"><a href="/documentation/user-guide/2.3#/53-restlet/version/default/part/ImageData/data"><img src="Prototype.js%20integration-52_files/data.html" alt="running_applicaion" title="running_applicaion"></a>
<a href="/documentation/user-guide/2.3#/53-restlet/version/default/part/ImageData/data">Click to enlarge</a></h2>
<h1 id="checkout-full-code">Checkout Full Code</h1>
<p><a href="/documentation/user-guide/2.3#/54-restlet/version/default/part/AttachmentData/data" title="microblog_sourcecode">microblog_sourcecode</a>
(application/x-zip, 2.3 MB)</p>
<h1 id="how-to-custom-finder-to-replace-tunnelservice">How to custom Finder to replace TunnelService</h1>
<p>Sure, you can custom a finder to do what tunnelService do.<br>
You can visit
<a href="http://dobrzanski.net/2007/04/22/using-put-and-delete-methods-in-ajax-requesta-with-prototypejs/">http://dobrzanski.net/2007/04/22/using-put-and-delete-methods-in-ajax-requesta-with-prototypejs/</a>
to get detail about how to using restful way in prototype.</p>
<p>A simpler way to do this is to customize the TunnelService.
getApplication().getTunnelService().setMethodName(&quot;_method&quot;). That&rsquo;s
all!</p>
<p>In Application:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>...<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>Router<span style="color:#bbb"> </span>router<span style="color:#bbb"> </span><span style="color:#666">=</span><span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">new</span><span style="color:#bbb"> </span>Router(getContext());<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#080;font-style:italic">//It&#39;s very easy!</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>router.<span style="color:#b44">setFinderClass</span>(PrototypeFinder.<span style="color:#b44">class</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>...</span></span></code></pre></div>
<p>Custom Finder:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a2f;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">class</span> <span style="color:#00f">PrototypeFinder</span><span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">extends</span><span style="color:#bbb"> </span>Finder<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">       </span><span style="color:#a2f;font-weight:bold">public</span><span style="color:#bbb">  </span><span style="color:#00a000">PrototypeFinder</span>(Context<span style="color:#bbb"> </span>context,<span style="color:#bbb"> </span>Class<span style="color:#bbb"> </span>targetClass)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">               </span><span style="color:#a2f;font-weight:bold">super</span>(context,<span style="color:#bbb"> </span>targetClass);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">       </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">       </span><span style="color:#a2f;font-weight:bold">public</span><span style="color:#bbb"> </span><span style="color:#0b0;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#00a000">handle</span>(Request<span style="color:#bbb"> </span>request,<span style="color:#bbb"> </span>Response<span style="color:#bbb"> </span>response)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">               </span><span style="color:#080;font-style:italic">//get  &#34;_method&#34; param value</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">               </span>Parameter<span style="color:#bbb"> </span>p<span style="color:#bbb"> </span><span style="color:#666">=</span><span style="color:#bbb"> </span>request.<span style="color:#b44">getEntityAsForm</span>().<span style="color:#b44">getFirst</span>(<span style="color:#b44">&#34;_method&#34;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">               </span><span style="color:#080;font-style:italic">//reset requst method accoring &#34;_method&#34; param value</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">               </span>request.<span style="color:#b44">setMethod</span>(<span style="color:#a2f;font-weight:bold">null</span><span style="color:#bbb"> </span><span style="color:#666">!=</span><span style="color:#bbb"> </span>p<span style="color:#bbb"> </span><span style="color:#666">?</span><span style="color:#bbb"> </span>Method.<span style="color:#b44">valueOf</span>(p.<span style="color:#b44">getValue</span>())<span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>request.<span style="color:#b44">getMethod</span>());<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">               </span><span style="color:#a2f;font-weight:bold">super</span>.<span style="color:#b44">handle</span>(request,<span style="color:#bbb"> </span>response);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">       </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>}</span></span></code></pre></div>
<p>javascript snippet in web page:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span><span style="color:#a2f;font-weight:bold">function</span> callJSON() {
</span></span><span style="display:flex;"><span>       <span style="color:#a2f;font-weight:bold">new</span> Ajax.Request(<span style="color:#b44">&#39;/ajax&#39;</span>, {
</span></span><span style="display:flex;"><span>               parameters<span style="color:#666">:</span> <span style="color:#b44">&#39;name=PUT&#39;</span>, method<span style="color:#666">:</span> <span style="color:#b44">&#39;put&#39;</span>, putBody<span style="color:#666">:</span> <span style="color:#b44">&#34;PUT BODY&#34;</span>,
</span></span><span style="display:flex;"><span>               onComplete<span style="color:#666">:</span> <span style="color:#a2f;font-weight:bold">function</span> (transport) {
</span></span><span style="display:flex;"><span>                       alert(transport.responseText);
</span></span><span style="display:flex;"><span>               }
</span></span><span style="display:flex;"><span>       });
</span></span><span style="display:flex;"><span>       <span style="color:#a2f;font-weight:bold">new</span> Ajax.Request(<span style="color:#b44">&#39;/ajax&#39;</span>, {
</span></span><span style="display:flex;"><span>               parameters<span style="color:#666">:</span> <span style="color:#b44">&#39;name=POST&#39;</span>, method<span style="color:#666">:</span> <span style="color:#b44">&#39;post&#39;</span>,
</span></span><span style="display:flex;"><span>               onComplete<span style="color:#666">:</span> <span style="color:#a2f;font-weight:bold">function</span> (transport) {
</span></span><span style="display:flex;"><span>                       alert(transport.responseText);
</span></span><span style="display:flex;"><span>               }
</span></span><span style="display:flex;"><span>       });
</span></span><span style="display:flex;"><span>       <span style="color:#a2f;font-weight:bold">new</span> Ajax.Request(<span style="color:#b44">&#39;/ajax&#39;</span>, {
</span></span><span style="display:flex;"><span>               parameters<span style="color:#666">:</span> <span style="color:#b44">&#39;name=DELETE&#39;</span>, method<span style="color:#666">:</span> <span style="color:#b44">&#39;delete&#39;</span>,
</span></span><span style="display:flex;"><span>               onComplete<span style="color:#666">:</span> <span style="color:#a2f;font-weight:bold">function</span> (transport) {
</span></span><span style="display:flex;"><span>                       alert(transport.responseText);
</span></span><span style="display:flex;"><span>               }
</span></span><span style="display:flex;"><span>       });
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>...</span></span></code></pre></div>
<h1 id="thanks">Thanks</h1>
<p><strong>Evgeny Shepelyuk</strong>: this guy gave me a lot of good advice!</p>
<h1 id="links">Links</h1>
<ul>
<li><a href="https://javadocs.restlet.talend.com/2.3/jse/api/org/restlet/routing/Router.html">Router</a></li>
<li><a href="https://javadocs.restlet.talend.com/2.3/jse/api/org/restlet/Application.html">Application</a></li>
<li><a href="https://javadocs.restlet.talend.com/2.3/jse/api/org/restlet/resource/Resource.html">Resource</a></li>
<li><a href="http://www.db4o.com/">db4o</a></li>
</ul>

      </div>
    </div>
  </div>
</div>

  </div>
</main>
    <footer>
  <div class="m-footer skew-top-black">
    <div class="container">
      <div class="row eq-height">
        <div class="col-sm-2">
          <h4>Features</h4>
          <ul>
            <li><a href="/features">Features</a></li>
          </ul>
        </div>
        <div class="col-sm-2">
          <h4>Downloads</h4>
          <ul>
            <li><a href="/downloads/current/">Current Release</a></li>
            <li><a href="/downloads/past/">Other Releases</a></li>
            <li><a href="/downloads/legal-terms/">Legal Terms</a></li>
            <li><a href="/downloads/faq/">FAQ</a></li>
          </ul>
        </div>
        <div class="col-sm-2">
          <h4>Documentation</h4>
          <ul>
            <li><a href="/documentation/user-guide/2.5/">User guide</a></li>
            <li><a href="/documentation/tutorials/2.5/">Tutorials</a></li>
            <li><a href="/documentation/javadocs/2.5/">Javadocs</a></li>
            <li><a href="/documentation/2.5/changelog">Changelog</a></li>
          </ul>
        </div>
      </div>
      <div class="row copyright">
        <div class="col-xs-12 col-md-8">
          <ul class="list-inline">
            <li>&copy; 2025 Qlik All rights reserved.</li>
          </ul>
        </div>
      </div>

    </div>
  </div>

</footer>

    <script type="text/javascript" src="/js/jquery-3.7.1.min.js"></script>
<script type="text/javascript" src="/js/modernizr-2.8.3.min.js"></script>
<script type="text/javascript" src="/js/jquery.dlmenu.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/js/bootstrap.min.js" integrity="sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd" crossorigin="anonymous"></script>
<script type="text/javascript" src="/js/init.js"></script>
<script type="text/javascript" src="/js/prism.js" data-default-language="markup"></script>
<script type="text/javascript" src="/js/app.js"></script>
<script type="text/javascript" src="/js/downloads.js"></script>


</body>
</html>
