{{/* look for the right ancestor of the current page: the one that defines the version */}}
{{- $currentPage := . }}
{{- $currentPageVersion := $currentPage.Params.version }}
{{ $section := . }}
{{- range .Ancestors }}
  {{- if eq .Page.Params.version $currentPageVersion }}
    {{ $section = . }}
  {{- end }}
{{- end }}

<nav class="inner-nav hidden-xs hidden-sm">
  <ul class="content-nav">
    {{- partial "inline/menu/walk.html" (dict "pageInMenu" $section "currentPage" $currentPage) }}
  </ul>
</nav>

{{- define "_partials/inline/menu/walk.html" }}
  {{- $page := .pageInMenu }}
  {{- $currentPage := .currentPage }}
  {{- $currentPageActive := (eq $currentPage.Permalink $page.Permalink) }}
  {{- $attrs := dict "href" $page.Permalink }}
  {{- $attrs = merge $attrs (dict "class" "navigation-list-link") }}

  {{- if $currentPageActive }}
    {{- $attrs = merge $attrs (dict "class" "navigation-list-link active" "aria-current" "page") }}
  {{- end }}

    <li {{- if $currentPageActive }} class="active" {{- end }}>  {{- $page.IsSection }}
      <a {{- range $k, $v := $attrs }}{{- with $v }}{{- printf " %s=%q" $k $v | safeHTMLAttr }}{{- end }}{{- end -}}>{{ $page.Title }}</a>

  {{- with $page.Pages }}
        <ul>
    {{- range sort . "Weight" "asc" }}
      {{- partial "inline/menu/walk.html" (dict "pageInMenu" . "currentPage" $currentPage) }}
        </ul>
    {{- end }}
  {{- else }}

  {{- end }}
    </li>
{{- end }}