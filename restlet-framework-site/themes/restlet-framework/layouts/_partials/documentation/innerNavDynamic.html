{{/* look for the right ancestor of the current page: the one that defines the version */}}
{{- $currentPage := . }}
{{- $currentPageVersion := $currentPage.Params.version }}
{{ $section := . }}
{{- range .Ancestors }}
  {{- if eq .Page.Params.version $currentPageVersion }}
    {{- $section = . }}
  {{- end }}
{{- end }}

<nav class="inner-nav hidden-xs hidden-sm">
  <ul class="content-nav">
    {{- partial "inline/menu/walkSection.html" (dict "pageInMenu" $section "currentPage" $currentPage) }}
  </ul>
</nav>

{{- define "_partials/inline/menu/walkSection.html" }}
  {{- $page := .pageInMenu }}
  {{- $currentPage := .currentPage }}

  {{- $currentPageActive := (eq $currentPage.Permalink $page.Permalink) }}

  {{- $attrs := dict "class" "navigation-list-link" }}
  {{- with $page.Aliases }}
    {{- $attrs = merge $attrs (dict "href" (index $page.Aliases 0)) }}
  {{- else }}
    {{- $attrs = merge $attrs (dict "href" $page.Permalink) }}   
  {{- end }}

  {{- if $currentPageActive }}
    {{- $attrs = merge $attrs (dict "class" "navigation-list-link active" "aria-current" "page") }}
  {{- end }}

      <li {{- if $currentPageActive }} class="active" {{- end }}>
        <a {{ range $k, $v := $attrs }}{{- with $v }}{{- printf " %s=%q" $k $v | safeHTMLAttr }}{{- end -}}{{- end -}}>
          {{ $page.Title }}
        </a>
  {{- with $page.Pages }}
        <ul>
    {{- with $page.Aliases }}{{/* We insert an overview link */}}
          <li {{- if $currentPageActive }} class="active" {{- end }}>
            <a {{ range $k, $v := $attrs }}{{- with $v }}{{- printf " %s=%q" $k $v | safeHTMLAttr }}{{- end -}}{{- end -}}>
              Overview
            </a>
          </li>
    {{- end }}
    {{- range sort . "Weight" "asc" }}
      {{- partial "inline/menu/walkSection.html" (dict "pageInMenu" . "currentPage" $currentPage) }}
    {{- end }}
        </ul>
  {{- end }}
      </li>
{{- end }}
